{% extends 'base_no_nav.html' %}
{% load static %}

{% block title %}Arbius Playground - Chat{% endblock %}

{% block extra_css %}
<style>
  html, body {
    height: 100%; min-height: 100%; background: #0a0a0a; color: #fff; font-family: 'Inter', sans-serif;
    /* overflow: hidden; */
  }
  .navbar {
    width: 100%; background: #0a0a0a; border-bottom: 1px solid #222; display: flex; align-items: center; justify-content: space-between; padding: 0 32px; height: 64px; min-height: 64px;
  }
  .navbar-logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.6rem; color: #fff; text-decoration: none; }
  .navbar-wallet { display: flex; align-items: center; gap: 10px; margin-right: 36px; }
  .wallet-btn-outline { background: rgba(0,0,0,0.55) !important; color: white !important; border: 1.5px solid white !important; box-shadow: none !important; transition: background 0.2s, color 0.2s, border 0.2s; backdrop-filter: blur(2px); padding: 8px 18px; border-radius: 12px; font-weight: 600; font-size: 1.05rem; }
  .wallet-btn-outline:hover { background: rgba(0,0,0,0.75) !important; color: #fff !important; }
  .playground-root { display: flex; height: calc(100vh - 64px); min-height: 0; background: #0a0a0a; /* overflow: visible; */ width: 100%; }
  .sidebar { width: 260px; background: #181818; border-right: 1px solid #222; display: flex; flex-direction: column; transition: width 0.3s; min-width: 56px; position: relative; overflow: visible; }
  .sidebar.collapsed {
    width: 18px !important;
    min-width: 18px !important;
    overflow: visible !important;
    position: relative;
    background: #181818;
  }
  .sidebar-header { padding: 18px 18px 0 18px; display: flex; flex-direction: column; gap: 12px; }
  .sidebar .history-label { font-size: 0.8rem; color: #888; letter-spacing: 0.1em; margin: 18px 0 8px 18px; text-transform: uppercase; font-weight: 600; }
  .sidebar .filter-pills { display: flex; gap: 8px; margin: 0 0 10px 18px; }
  .filter-pill { background: #232323; color: #fff; border: none; border-radius: 999px; padding: 4px 12px; font-size: 0.95rem; cursor: pointer; transition: background 0.2s, color 0.2s; }
  .filter-pill.active, .filter-pill:hover { background: #fff; color: #181818; }
  .sidebar .history-list { flex: 1; overflow-y: auto; padding: 0 0 18px 0; margin: 0; }
  .history-item { display: flex; align-items: center; gap: 10px; padding: 9px 18px; font-size: 1rem; color: #ccc; cursor: pointer; border: none; background: none; width: 100%; transition: background 0.2s, color 0.2s; border-radius: 8px; }
  .history-item.selected, .history-item:hover { background: #232323; color: #fff; }
  .sidebar-toggle-btn {
    position: absolute;
    top: 50%;
    left: 100%;
    transform: translate(-50%, -50%);
    z-index: 60;
    background: #232323;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.10);
    transition: background 0.2s, left 0.3s;
  }
  .sidebar-toggle-btn:hover { background: #333; }
  .sidebar.collapsed .sidebar-header,
  .sidebar.collapsed .history-label,
  .sidebar.collapsed .filter-pills,
  .sidebar.collapsed .model-pills,
  .sidebar.collapsed .history-list {
    display: none !important;
  }
  .sidebar.collapsed {
    width: 18px !important;
    min-width: 18px !important;
    overflow: visible !important;
    position: relative;
    background: #181818;
  }
  .sidebar.collapsed .sidebar-toggle-btn {
    left: 100%;
    transform: translate(-50%, -50%);
  }
  .sidebar.collapsed .history-item { justify-content: center; padding-left: 0; padding-right: 0; }
  .sidebar.collapsed .history-item span { display: none; }
  .sidebar.collapsed .history-item i { margin: 0; }
  .main-area { flex: 1; display: flex; flex-direction: column; height: 100%; min-width: 0; background: #0a0a0a; width: 100%; }
  .main-header { display: flex; align-items: center; justify-content: space-between; padding: 28px 36px 12px 36px; border-bottom: 1px solid #222; }
  .main-header .model-indicator { font-size: 0.95rem; color: #aaa; margin-top: 2px; }
  .chat-area {
    flex: 1;
    width: 100%;
    min-height: 0;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    padding: 28px 0 0 0;
    background: #0a0a0a;
    position: relative;
  }
  .chat-messages-inner {
    max-width: 1100px;
    margin: 0 auto;
    width: 100%;
  }
  .sidebar-collapsed .chat-messages-inner,
  .sidebar-collapsed .chat-input-inner {
    max-width: 1400px;
  }
  .chat-message-row {
    display: flex;
    align-items: flex-end;
    width: 100%;
    margin-bottom: 18px;
    padding-left: 0;
    padding-right: 0;
  }
  .chat-message-row.user {
    justify-content: flex-end;
  }
  .chat-message-row.assistant {
    justify-content: flex-start;
    flex-direction: row;
  }
  .chat-message-row.assistant .chat-message-avatar {
    margin-left: 0;
    margin-right: 8px;
    order: 0;
  }
  .chat-message-row.assistant .chat-message-content {
    margin-left: 0;
    margin-right: 0;
    order: 1;
  }
  .chat-message-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #181818;
    border: 2px solid #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1rem;
    margin: 0 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    padding: 0;
  }
  .chat-message-row.user .chat-message-avatar {
    display: none;
  }
  .chat-message-row.assistant .chat-message-avatar {
    background: #3b82f6;
    color: #fff;
    order: 1;
  }
  .chat-message-content {
    font-size: 0.82rem;
    line-height: 1.35;
    word-break: break-word;
    display: inline-block;
  }
  .chat-message-row.user .chat-message-content {
    background: #232323;
    color: #fff;
    border-radius: 14px;
    padding: 10px 16px;
    margin-right: 8px;
    margin-left: 0;
    max-width: 90vw;
  }
  .chat-message-row.assistant .chat-message-content {
    background: none;
    color: #fff;
    border-radius: 0;
    padding: 0;
    margin-left: 8px;
    margin-right: 0;
    max-width: 90vw;
  }
  .chat-message-actions { display: flex; align-items: center; gap: 8px; margin-top: 2px; }
  .chat-message-actions button { background: none; border: none; color: #aaa; cursor: pointer; font-size: 1.1rem; padding: 2px 6px; border-radius: 6px; transition: background 0.2s, color 0.2s; }
  .chat-message-actions button:hover { background: #232323; color: #fff; }
  .chat-input-bar { width: 100%; padding: 0 0 18px 0; background: none; border: none; display: flex; align-items: center; justify-content: center; }
  .chat-input-inner {
    display: flex;
    align-items: center;
    width: 100%;
    background: #181818;
    border-radius: 999px;
    border: 1.5px solid #fff;
    padding: 8px 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  }
  /* Wider input when sidebar is collapsed */
  .sidebar.collapsed ~ .main-area .chat-input-inner {
    max-width: 1400px;
  }
  .chat-input-inner textarea {
    flex: 1;
    background: transparent;
    border: none;
    color: #fff;
    font-size: 0.82rem;
    line-height: 1.35;
    padding: 5px 0;
    resize: none;
    outline: none;
    min-height: 32px;
    max-height: 100px;
  }
  .chat-input-inner button { background: #fff; color: #181818; border: none; border-radius: 50%; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; margin-left: 8px; cursor: pointer; transition: background 0.2s, color 0.2s; }
  .chat-input-inner button:hover { background: #e5e5e5; color: #181818; }
  .model-select-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10,10,10,0.98); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .model-select-title { font-size: 2rem; font-weight: 600; margin-bottom: 32px; color: #fff; }
  .model-select-pills { display: flex; gap: 18px; margin-bottom: 18px; }
  .model-select-pill { display: flex; align-items: center; gap: 8px; padding: 14px 28px; border-radius: 999px; background: #232323; color: #fff; font-size: 1.1rem; font-weight: 500; border: none; cursor: pointer; transition: background 0.2s, color 0.2s; }
  .model-select-pill.selected, .model-select-pill:hover { background: #fff; color: #181818; }
  .model-select-pill.disabled { opacity: 0.5; cursor: not-allowed; }
  @media (max-width: 900px) { .sidebar { width: 56px !important; min-width: 56px !important; } .sidebar:not(.collapsed) { width: 220px !important; } .main-header, .chat-message-row { padding-left: 16px; padding-right: 16px; } }
  @media (max-width: 600px) { .main-header, .chat-message-row { padding-left: 4px; padding-right: 4px; } .chat-input-inner { max-width: 98vw; } }
#chat-selected-model-short {
  margin-right: 2px !important;
}
.chat-input-inner button {
  margin-left: 2px !important;
}
.chat-input-inner {
  padding-left: 6px !important;
  padding-right: 6px !important;
}
.chat-main-inner {
  max-width: 900px;
  margin: 0 auto;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  position: relative;
  min-height: 100vh;
  padding-bottom: 0; /* remove extra space for fixed input bar */
}
.sidebar-collapsed .chat-main-inner {
  max-width: 1200px;
}
.chat-messages-inner {
  width: 100%;
  /* Remove max-width here */
}
.chat-input-bar {
  position: sticky;
  bottom: 0;
  left: 0;
  right: 0;
  width: 100%;
  background: none;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  padding: 0 0 18px 0;
  margin-left: 0;
  transition: none;
}
.sidebar.collapsed ~ .main-area .chat-input-bar,
.sidebar-collapsed .chat-input-bar {
  margin-left: 18px;
}
.chat-input-inner {
  display: flex;
  align-items: center;
  width: 100%;
  background: #181818;
  border-radius: 999px;
  border: 1.5px solid #fff;
  padding: 8px 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  max-width: 900px;
  margin: 0 auto;
}
.sidebar-collapsed .chat-input-inner {
  max-width: 1200px;
}
/* Center model selection UI */
#model-select-center {
  max-width: 1100px;
  margin: 0 auto;
  left: 0;
  right: 0;
}
.sidebar-collapsed #model-select-center {
  max-width: 1400px;
}
  .history-item {
    font-size: 0.85rem;
    line-height: 1.3;
    padding: 7px 14px;
  }
  .sidebar .history-label {
    font-size: 0.75rem;
  }
  .sidebar .filter-pills, .sidebar .history-list {
    font-size: 0.85rem;
  }
  .wallet-btn-outline, .navbar-wallet .wallet-btn-outline, #connect-wallet-btn, #connect-wallet-btn-mobile {
    background: #fff !important;
    color: #181828 !important;
    border: none !important;
    box-shadow: none !important;
    border-radius: 999px !important;
    font-size: 0.95rem !important;
    font-weight: 500 !important;
    padding: 6px 22px !important;
    min-width: 0 !important;
    min-height: 0 !important;
    height: auto !important;
    display: inline-flex;
    align-items: center !important;
    justify-content: center !important;
    gap: 0 !important;
  }
  .wallet-connected-dropdown {
    display: inline-block;
    position: relative;
    vertical-align: middle;
  }
  .wallet-address-pill {
    background: transparent;
    color: #fff;
    border: 2px solid #fff;
    border-radius: 999px;
    font-size: 0.95rem;
    font-weight: 500;
    padding: 6px 22px;
    min-width: 0;
    min-height: 0;
    height: auto;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    margin-bottom: 6px;
    transition: border 0.2s, background 0.2s;
  }
  .wallet-address-pill:hover, .wallet-address-pill:focus {
    background: rgba(255,255,255,0.08);
    border-color: #fff;
  }
  .wallet-dropdown-menu {
    position: absolute;
    top: 110%;
    left: 0;
    background: #232a3a;
    border-radius: 18px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.18);
    padding: 22px 0 18px 0;
    min-width: 210px;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .wallet-dropdown-item {
    color: #fff;
    text-decoration: none;
    font-size: 1.08rem;
    padding: 12px 28px 12px 22px;
    display: flex;
    align-items: center;
    gap: 16px;
    border: none;
    background: none;
    cursor: pointer;
    transition: background 0.15s;
    border-radius: 12px;
  }
  .wallet-dropdown-item:hover {
    background: #2e3542;
  }
</style>
{% endblock %}

{% block content %}
<!-- Navbar -->
<nav class="navbar">
  <a href="/" class="navbar-logo">
    <img src="{% static 'arbius.ef337b97.svg' %}" alt="Arbius Logo" class="inline-block w-7 h-7" />
    Arbius
  </a>
  <div class="navbar-wallet">
    <button id="connect-wallet-btn" class="wallet-btn-outline">Connect</button>
    <div id="wallet-connected-container" class="wallet-connected-dropdown" style="display:none;position:relative;">
      <button id="navbar-wallet-address-pill" class="wallet-address-pill">@wallet</button>
      <div id="navbar-wallet-dropdown-menu" class="wallet-dropdown-menu" style="display:none;">
        <a href="#" class="wallet-dropdown-item"><img src="https://arbiscan.io/images/svg/brands/arbitrum.svg" style="width:18px;height:18px;vertical-align:middle;margin-right:8px;">Arbiscan</a>
        <a href="#" class="wallet-dropdown-item"><i class="fas fa-chart-pie" style="width:18px;margin-right:8px;"></i>Usage</a>
        <button id="disconnect-wallet-btn" class="wallet-dropdown-item"><i class="fas fa-unlink" style="width:18px;margin-right:8px;"></i>Disconnect</button>
      </div>
    </div>
  </div>
</nav>
<div class="playground-root">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <button class="sidebar-toggle-btn" id="sidebar-toggle-btn"><i class="fas fa-angle-left"></i></button>
    <div class="sidebar-header">
      <button id="new-chat-btn" style="background:#fff;color:#181818;font-weight:600;border:none;border-radius:999px;padding:10px 0;margin-bottom:18px;display:flex;align-items:center;justify-content:center;gap:8px;font-size:1.05rem;cursor:pointer;width:100%;"><i class="fas fa-plus"></i> <span style="font-size:1rem;">New Chat</span></button>
    </div>
    <div class="history-label">History</div>
    <div class="filter-pills">
      <button class="filter-pill active" data-type="all">All</button>
      <button class="filter-pill" data-type="text"><i class="fas fa-comment-dots"></i></button>
      <button class="filter-pill" data-type="image"><i class="fas fa-image"></i></button>
      <button class="filter-pill" data-type="video"><i class="fas fa-video"></i></button>
      </div>
    <div class="history-list" id="history-list">
      <div class="history-item" data-id="test" data-type="text"><i class="fas fa-comment-dots"></i> <span>Test Conversation</span></div>
      <div class="history-item" data-id="basilisk" data-type="text"><i class="fas fa-comment-dots"></i> <span>What is Roko's Basilisk?</span></div>
      <div class="history-item" data-id="malinois" data-type="text"><i class="fas fa-comment-dots"></i> <span>How to train a Belgian Malinois</span></div>
      <div class="history-item" data-id="elon" data-type="image"><i class="fas fa-image"></i> <span>Elon Musk naked with...</span></div>
      <div class="history-item" data-id="koala" data-type="text"><i class="fas fa-comment-dots"></i> <span>Koala</span></div>
      <div class="history-item" data-id="film" data-type="video"><i class="fas fa-video"></i> <span>AI-generated short film</span></div>
      </div>
  </aside>
  <!-- Main Area -->
  <main class="main-area" style="position: relative;">
    <div class="chat-main-inner">
      <div class="chat-area" id="chat-area" style="position:relative;">
        <div class="chat-messages-inner">
          <!-- Model Selection Centered (inline, not overlay) -->
          <div id="model-select-center" style="width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;top:0;left:0;pointer-events:auto;">
            <div style="font-size:1.1rem;font-weight:500;color:#fff;margin-bottom:20px;">Select Model</div>
            <div style="display:flex;gap:16px;">
              <button class="model-bubble" data-model="m8b-uncensored" style="background:transparent;color:#fff;border:1.5px solid #444;border-radius:999px;padding:10px 20px;font-size:0.98rem;font-weight:500;display:flex;align-items:center;gap:8px;transition:background 0.2s,border 0.2s;cursor:pointer;outline:none;">
                <i class="fas fa-comment-dots" style="font-size:1.05rem;"></i> M8B-Uncensored
              </button>
              <button class="model-bubble" data-model="wai" style="background:transparent;color:#fff;border:1.5px solid #444;border-radius:999px;padding:10px 20px;font-size:0.98rem;font-weight:500;display:flex;align-items:center;gap:8px;transition:background 0.2s,border 0.2s;cursor:pointer;outline:none;">
                <i class="fas fa-image" style="font-size:1.05rem;"></i> WAI SDXL (NSFW)
              </button>
              <button class="model-bubble" data-model="qwen-qwq" style="background:transparent;color:#fff;border:1.5px solid #444;border-radius:999px;padding:10px 20px;font-size:0.98rem;font-weight:500;display:flex;align-items:center;gap:8px;transition:background 0.2s,border 0.2s;cursor:pointer;outline:none;">
                <i class="fas fa-comment-dots" style="font-size:1.05rem;"></i> Qwen QwQ 32b
              </button>
            </div>
          </div>
          <!-- Test Conversation -->
          <div id="test-conversation" class="chat-conversation" style="display:none;">
            <div class="chat-message-row user">
              <div class="chat-message-content">Hello, what can you do?</div>
            </div>
            <div class="chat-message-row assistant">
              <div class="chat-message-avatar" style="background:#181818; border:2px solid #fff; display:flex; align-items:center; justify-content:center; width:32px; height:32px;">
                <svg width="24" height="24" viewBox="0 0 59 59" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g>
                    <mask id="mask0" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="35" y="16" width="22" height="27">
                      <path d="M35.2554 16.6075H56.3788V42.3927H35.2554V16.6075Z" fill="white"/>
                    </mask>
                    <g mask="url(#mask0)">
                      <mask id="mask1" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="35" y="16" width="22" height="27">
                        <path d="M45.7316 42.357C40.5529 42.357 36.2412 37.8586 35.3119 31.9122H40.3779C41.1041 35.0779 43.2269 37.37 45.7316 37.37C48.8373 37.37 51.3542 33.849 51.3542 29.5071C51.3542 25.1649 48.8373 21.643 45.7316 21.643C43.2261 21.643 41.1041 23.9351 40.3779 27.1011H35.311C36.2412 21.1553 40.5521 16.6569 45.7316 16.6569C51.5895 16.6569 56.3386 22.4106 56.3386 29.5071C56.3386 36.6035 51.5895 42.357 45.7316 42.357Z" fill="white"/>
                      </mask>
                      <g mask="url(#mask1)">
                        <path d="M35.311 16.6569V42.357H56.3386V16.6569H35.311Z" fill="#fff"/>
                      </g>
                    </g>
                    <mask id="mask2" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="2" y="16" width="52" height="27">
                      <path d="M2.62305 16.6075H53.9021V42.3927H2.62305V16.6075Z" fill="white"/>
                    </mask>
                    <g mask="url(#mask2)">
                      <mask id="mask3" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="2" y="16" width="52" height="27">
                        <path d="M13.271 37.3701C16.3764 37.3701 18.8933 33.849 18.8933 29.5071C18.8933 25.1649 16.3764 21.643 13.271 21.643C10.1654 21.643 7.64845 25.164 7.64845 29.5071C7.64845 33.8499 10.1654 37.3701 13.271 37.3701ZM13.271 42.357C7.41314 42.357 2.66406 36.6035 2.66406 29.5071C2.66406 22.4106 7.41314 16.6569 13.271 16.6569C18.4244 16.6569 22.7191 21.1112 23.6771 27.0135H51.0619L53.8429 29.5071L51.0619 32.0004H23.6771C22.7191 37.903 18.4244 42.357 13.271 42.357Z" fill="white"/>
                      </mask>
                      <g mask="url(#mask3)">
                        <path d="M2.66406 16.6569V42.357H53.8429V16.6569H2.66406Z" fill="#fff"/>
                      </g>
                    </g>
                  </g>
                </svg>
              </div>
              <div class="chat-message-content">Hi! I can answer questions, generate images, and more. Try asking me anything!</div>
            </div>
            <div class="chat-message-row user">
              <div class="chat-message-content">Draw a cat surfing a wave.</div>
            </div>
            <div class="chat-message-row assistant">
              <div class="chat-message-avatar" style="background:#181818; border:2px solid #fff; display:flex; align-items:center; justify-content:center; width:32px; height:32px;">
                <svg width="24" height="24" viewBox="0 0 59 59" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g>
                    <mask id="mask0b" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="35" y="16" width="22" height="27">
                      <path d="M35.2554 16.6075H56.3788V42.3927H35.2554V16.6075Z" fill="white"/>
                    </mask>
                    <g mask="url(#mask0b)">
                      <mask id="mask1b" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="35" y="16" width="22" height="27">
                        <path d="M45.7316 42.357C40.5529 42.357 36.2412 37.8586 35.3119 31.9122H40.3779C41.1041 35.0779 43.2269 37.37 45.7316 37.37C48.8373 37.37 51.3542 33.849 51.3542 29.5071C51.3542 25.1649 48.8373 21.643 45.7316 21.643C43.2261 21.643 41.1041 23.9351 40.3779 27.1011H35.311C36.2412 21.1553 40.5521 16.6569 45.7316 16.6569C51.5895 16.6569 56.3386 22.4106 56.3386 29.5071C56.3386 36.6035 51.5895 42.357 45.7316 42.357Z" fill="white"/>
                      </mask>
                      <g mask="url(#mask1b)">
                        <path d="M35.311 16.6569V42.357H56.3386V16.6569H35.311Z" fill="#fff"/>
                      </g>
                    </g>
                    <mask id="mask2b" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="2" y="16" width="52" height="27">
                      <path d="M2.62305 16.6075H53.9021V42.3927H2.62305V16.6075Z" fill="white"/>
                    </mask>
                    <g mask="url(#mask2b)">
                      <mask id="mask3b" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="2" y="16" width="52" height="27">
                        <path d="M13.271 37.3701C16.3764 37.3701 18.8933 33.849 18.8933 29.5071C18.8933 25.1649 16.3764 21.643 13.271 21.643C10.1654 21.643 7.64845 25.164 7.64845 29.5071C7.64845 33.8499 10.1654 37.3701 13.271 37.3701ZM13.271 42.357C7.41314 42.357 2.66406 36.6035 2.66406 29.5071C2.66406 22.4106 7.41314 16.6569 13.271 16.6569C18.4244 16.6569 22.7191 21.1112 23.6771 27.0135H51.0619L53.8429 29.5071L51.0619 32.0004H23.6771C22.7191 37.903 18.4244 42.357 13.271 42.357Z" fill="white"/>
                      </mask>
                      <g mask="url(#mask3b)">
                        <path d="M2.66406 16.6569V42.357H53.8429V16.6569H2.66406Z" fill="#fff"/>
                      </g>
                    </g>
                  </g>
                </svg>
              </div>
              <div class="chat-message-content">Here's an image of a cat surfing a wave! üèÑ‚Äç‚¨õüåä</div>
            </div>
          </div>
          <!-- Add more conversations here as needed -->
        </div>
      </div>
      <form class="chat-input-bar" autocomplete="off" style="padding-bottom:10px;">
        <div class="chat-input-inner" style="min-height:36px;padding:4px 12px;">
          <div id="chat-selected-model-short" style="background:#232323;color:#fff;border-radius:999px;padding:4px 14px;font-size:1rem;font-weight:600;display:none;align-items:center;gap:7px;margin-right:10px;">
            <span id="current-model-icon" style="font-size:1.1rem;display:flex;align-items:center;"></span>
            <span id="current-model-pill"></span>
          </div>
          <textarea placeholder="Type your message..." rows="1" style="min-height:28px;font-size:1rem;"></textarea>
          <button type="submit"><i class="fas fa-paper-plane"></i></button>
        </div>
      </form>
      <!-- Model Selection Overlay (hidden by default, show with JS) -->
      <div id="model-select-overlay" class="model-select-overlay" style="display: none;">
        <div class="model-select-title">Choose your preferred model</div>
        <div class="model-select-pills">
          <button class="model-select-pill" data-model="m8b-uncensored">üìù M8B-Uncensored</button>
          <button class="model-select-pill" data-model="qwen-qwq-32b">üìù Qwen QwQ 32b</button>
          <button class="model-select-pill" data-model="wai-sdxl">üñºÔ∏è WAI SDXL (NSFW)</button>
          <button class="model-select-pill disabled" disabled>‚è≥ More coming soon...</button>
</div>
      </div>
    </div>
  </main>
</div>
<script>
// Sidebar collapse logic
const sidebar = document.getElementById('sidebar');
const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
const playgroundRoot = document.querySelector('.playground-root');
sidebarToggleBtn.addEventListener('click', () => {
  sidebar.classList.toggle('collapsed');
  sidebarToggleBtn.querySelector('i').classList.toggle('fa-angle-left');
  sidebarToggleBtn.querySelector('i').classList.toggle('fa-angle-right');
  if (playgroundRoot) {
    if (sidebar.classList.contains('collapsed')) {
      playgroundRoot.classList.add('sidebar-collapsed');
    } else {
      playgroundRoot.classList.remove('sidebar-collapsed');
    }
  }
});
// History filter logic
const filterPills = document.querySelectorAll('.filter-pill');
const historyItems = document.querySelectorAll('.history-item');
filterPills.forEach(pill => {
  pill.addEventListener('click', () => {
    filterPills.forEach(p => p.classList.remove('active'));
    pill.classList.add('active');
    const type = pill.getAttribute('data-type');
    historyItems.forEach(item => {
      if (type === 'all' || item.getAttribute('data-type') === type) {
        item.style.display = '';
      } else {
        item.style.display = 'none';
      }
    });
  });
});
// --- REIMPLEMENTED LOGIC ---
const chatArea = document.getElementById('chat-area');
const modelSelectCenter = document.getElementById('model-select-center');
const modelBubbles = document.querySelectorAll('.model-bubble');
const modelPill = document.getElementById('chat-selected-model-short');
const modelPillLabel = document.getElementById('current-model-pill');
const modelPillIcon = document.getElementById('current-model-icon');
const newChatBtn = document.getElementById('new-chat-btn');
let currentModel = null;
let currentConversationId = null;

function showModelSelect() {
  modelSelectCenter.style.display = 'flex';
  if (modelPill) modelPill.style.display = 'none';
  // Hide all conversations
  chatArea.querySelectorAll('.chat-conversation').forEach(e => e.style.display = 'none');
  // Deselect all history items
  document.querySelectorAll('.history-item').forEach(item => item.classList.remove('selected'));
}
function hideModelSelect() {
  modelSelectCenter.style.display = 'none';
}
function showConversation(convoId) {
  // Hide model select
  hideModelSelect();
  // Hide all conversations
  chatArea.querySelectorAll('.chat-conversation').forEach(e => e.style.display = 'none');
  // Show the selected conversation
  const convo = document.getElementById(convoId);
  if (convo) convo.style.display = '';
}
function showModelPill(model) {
  const MODEL_MAP = {
    'm8b-uncensored': { label: 'M8B', icon: '<i class="fas fa-comment-dots"></i>' },
    'wai': { label: 'WAI', icon: '<i class="fas fa-image"></i>' },
    'qwen-qwq': { label: 'Qwen', icon: '<i class="fas fa-comment-dots"></i>' },
    'deepseek': { label: 'Deepseek', icon: '<i class="fas fa-code"></i>' }
  };
  if (model && MODEL_MAP[model]) {
    modelPill.style.display = 'flex';
    modelPillLabel.textContent = MODEL_MAP[model].label;
    modelPillIcon.innerHTML = MODEL_MAP[model].icon;
  } else {
    modelPill.style.display = 'none';
    modelPillLabel.textContent = '';
    modelPillIcon.innerHTML = '';
  }
}
function clearModelSelection() {
  currentModel = null;
  showModelSelect();
  showModelPill(null);
}
// On page load, always show model selection
window.addEventListener('DOMContentLoaded', () => {
  clearModelSelection();
});
// Model selection bubbles
modelBubbles.forEach(btn => {
  btn.addEventListener('click', () => {
    currentModel = btn.getAttribute('data-model');
    hideModelSelect();
    showModelPill(currentModel);
    // Show a new/empty conversation area (or keep it empty)
    // Optionally, you can create a new conversation div dynamically here
  });
});
// New Chat button
if (newChatBtn) {
  newChatBtn.addEventListener('click', () => {
    clearModelSelection();
  });
}
// History item click
historyItems.forEach(item => {
  item.addEventListener('click', () => {
    // Deselect all
    historyItems.forEach(i => i.classList.remove('selected'));
    item.classList.add('selected');
    // Show the conversation
    const convoId = item.getAttribute('data-id') + '-conversation';
    showConversation(convoId);
    // For demo: set model to M8B for test, Qwen for basilisk, WAI for elon, etc.
    let model = null;
    if (item.getAttribute('data-id') === 'test') model = 'm8b-uncensored';
    else if (item.getAttribute('data-id') === 'basilisk') model = 'qwen-qwq';
    else if (item.getAttribute('data-id') === 'elon') model = 'wai';
    else model = 'm8b-uncensored'; // fallback
    showModelPill(model);
    hideModelSelect();
  });
});
// Copy button logic
const copyBtns = document.querySelectorAll('.copy-btn');
copyBtns.forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.preventDefault();
    const content = btn.parentElement.previousElementSibling.textContent;
    navigator.clipboard.writeText(content);
    btn.classList.add('copied');
    setTimeout(() => btn.classList.remove('copied'), 800);
  });
});
// Model indicator update
function updateModelPill() {
  let model = null;
  if (window.getSelectedModel) {
    const stored = window.getSelectedModel();
    // Only treat as selected if not null/undefined/empty string
    if (stored && stored !== 'null' && stored !== 'undefined' && stored !== '') {
      model = stored;
    }
  }
  const pill = document.getElementById('chat-selected-model-short');
  const pillLabel = document.getElementById('current-model-pill');
  const pillIcon = document.getElementById('current-model-icon');
  if (!pill || !pillLabel || !pillIcon) return;
  const MODEL_MAP = {
    'm8b-uncensored': { label: 'M8B', icon: '<i class="fas fa-comment-dots"></i>' },
    'wai': { label: 'WAI', icon: '<i class="fas fa-image"></i>' },
    'qwen-qwq': { label: 'Qwen', icon: '<i class="fas fa-comment-dots"></i>' },
    'deepseek': { label: 'Deepseek', icon: '<i class="fas fa-code"></i>' }
  };
  if (model && MODEL_MAP[model]) {
    pill.style.display = 'flex';
    pillLabel.textContent = MODEL_MAP[model].label;
    pillIcon.innerHTML = MODEL_MAP[model].icon;
  } else {
    pill.style.display = 'none';
    pillLabel.textContent = '';
    pillIcon.innerHTML = '';
  }
}
document.addEventListener('DOMContentLoaded', updateModelPill);
if (window.setSelectedModel) {
  const orig = window.setSelectedModel;
  window.setSelectedModel = function(model) {
    orig(model);
    updateModelPill();
  };
}
// Model selection center logic (inline, not overlay)
function isChatEmpty() {
  // Check if there are any visible chat messages
  return !chatArea.querySelector('.chat-message-row');
}
// Hide model select if a message is sent (optional: you can also call this after sending a message)
// Wallet dropdown logic (guaranteed to run after DOM and after all other JS)
document.addEventListener('DOMContentLoaded', function() {
  const walletAddressPill = document.getElementById('navbar-wallet-address-pill');
  const walletDropdownMenu = document.getElementById('navbar-wallet-dropdown-menu');
  if (walletAddressPill && walletDropdownMenu) {
    walletAddressPill.addEventListener('click', function(e) {
      e.stopPropagation();
      walletDropdownMenu.style.display = walletDropdownMenu.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('click', function(e) {
      if (!walletDropdownMenu.contains(e.target) && e.target !== walletAddressPill) {
        walletDropdownMenu.style.display = 'none';
      }
    });
  }
});
</script>
{% endblock %} 