{% extends 'base.html' %}

{% block content %}
<div class="min-h-screen bg-darkbg text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Hero Section -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4">
                <span class="text-blue-400">üîß</span> Mining Analytics Dashboard
            </h1>
            <p class="text-textmuted text-lg">
                Comprehensive analytics for Arbius (AIUS) mining operations and token sales tracking
            </p>
        </div>

        <!-- Token Analysis Status -->
        {% if not has_token_data %}
        <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6 mb-8">
            <h5 class="text-blue-400 font-semibold mb-2">üìä Token Analysis Required</h5>
            <p class="text-textmuted mb-2">Token tracking data is not available yet. The system needs to analyze miner wallets to track AIUS token movements and sales.</p>
            <p class="text-textmuted text-sm">Run the following command to start analysis: <code class="bg-darkbg px-2 py-1 rounded">python manage.py analyze_miner_tokens --all</code></p>
        </div>
        {% endif %}

        <!-- Network Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-darkbg border border-border rounded-lg p-6">
                <div class="text-3xl font-bold text-blue-400 mb-2">{{ total_tasks|floatformat:0 }}</div>
                <div class="text-textmuted">Total Tasks Completed</div>
            </div>
            <div class="bg-darkbg border border-border rounded-lg p-6">
                <div class="text-3xl font-bold text-green-400 mb-2">
                    {% if has_token_data %}
                        {{ total_aius_earned|floatformat:1 }}
                    {% else %}
                        <span class="text-textmuted">-</span>
                    {% endif %}
                </div>
                <div class="text-textmuted">Total AIUS Earned</div>
            </div>
            <div class="bg-darkbg border border-border rounded-lg p-6">
                <div class="text-3xl font-bold text-cyan-400 mb-2">
                    {% if has_token_data %}
                        ${{ total_usd_sold|floatformat:0 }}
                    {% else %}
                        <span class="text-textmuted">-</span>
                    {% endif %}
                </div>
                <div class="text-textmuted">Total $ from Sales</div>
            </div>
        </div>

        <!-- Miner Statistics -->
        <div class="bg-darkbg border border-border rounded-lg p-6 mb-8">
            <h3 class="text-xl font-semibold mb-6 flex items-center">
                <span class="text-blue-400 mr-2">üë•</span> Miner Statistics
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-border">
                            <th class="text-left py-3 px-4">Miner</th>
                            <th class="text-left py-3 px-4">Tasks Completed</th>
                            <th class="text-left py-3 px-4">First Task</th>
                            <th class="text-left py-3 px-4">Last Task</th>
                            <th class="text-left py-3 px-4">AIUS Earned</th>
                            <th class="text-left py-3 px-4">$ Made from Selling</th>
                            <th class="text-left py-3 px-4">Analysis Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for miner in miners_stats %}
                        <tr class="border-b border-border/30 hover:bg-white/5">
                            <td class="py-3 px-4">
                                <a href="https://arbiscan.io/address/{{ miner.solution_provider }}" target="_blank" class="text-blue-400 hover:text-blue-300">
                                    {{ miner.short_address }}
                                </a>
                            </td>
                            <td class="py-3 px-4">{{ miner.total_tasks_completed }}</td>
                            <td class="py-3 px-4">{{ miner.first_task_formatted }}</td>
                            <td class="py-3 px-4">{{ miner.last_task_formatted }}</td>
                            <td class="py-3 px-4">
                                {% if miner.has_real_earnings %}
                                    <span class="text-green-400">{{ miner.aius_earned|floatformat:2 }}</span>
                                {% else %}
                                    <span class="text-textmuted">-</span>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                {% if miner.usd_from_sales > 0 %}
                                    <span class="text-green-400">${{ miner.usd_from_sales|floatformat:2 }}</span>
                                {% elif miner.has_real_earnings %}
                                    <span class="text-yellow-400">$0.00</span>
                                {% else %}
                                    <span class="text-textmuted">-</span>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                {% if miner.has_real_earnings %}
                                    <span class="text-green-400 text-xs">‚úì Analyzed</span>
                                    {% if miner.last_analyzed %}
                                        <br><span class="text-textmuted text-xs">{{ miner.last_analyzed|date:"M d, Y" }}</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-yellow-400 text-xs">‚è≥ Pending</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Recent Mining Activity -->
        <div class="bg-darkbg border border-border rounded-lg p-6">
            <h3 class="text-xl font-semibold mb-6 flex items-center">
                <span class="text-blue-400 mr-2">‚è∞</span> Recent Mining Activity
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-border">
                            <th class="text-left py-3 px-4">Time</th>
                            <th class="text-left py-3 px-4">Miner</th>
                            <th class="text-left py-3 px-4">Task Submitter</th>
                            <th class="text-left py-3 px-4">Prompt</th>
                            <th class="text-left py-3 px-4">Model</th>
                            <th class="text-left py-3 px-4">Transaction</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for activity in recent_mining_activity %}
                        <tr class="border-b border-border/30 hover:bg-white/5">
                            <td class="py-3 px-4 text-textmuted">
                                {{ activity.timestamp|date:"M d, H:i" }}
                            </td>
                            <td class="py-3 px-4">
                                <span class="text-blue-400">{{ activity.miner_display_name }}</span>
                            </td>
                            <td class="py-3 px-4">
                                <span class="text-green-400">{{ activity.submitter_display_name }}</span>
                            </td>
                            <td class="py-3 px-4 max-w-xs truncate" title="{{ activity.prompt }}">
                                {{ activity.prompt_short }}
                            </td>
                            <td class="py-3 px-4 text-textmuted">
                                {{ activity.model_id|slice:":10" }}...
                            </td>
                            <td class="py-3 px-4">
                                <a href="https://arbiscan.io/tx/{{ activity.transaction_hash }}" target="_blank" class="text-blue-400 hover:text-blue-300 text-xs">
                                    {{ activity.transaction_hash|slice:":10" }}...
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %} 